<!DOCTYPE html>
<html>
<head>
<title>Face + Uniform System</title>
<style>
    body {
        background:#111;
        color:#eee;
        text-align:center;
        font-family:Arial, sans-serif;
    }
    #camera {
        width:80%;
        margin-top:20px;
        border-radius:12px;
        border:3px solid #333;
    }
    #result {
        margin-top:25px;
        padding:15px;
        font-size:22px;
        background:#222;
        border-radius:10px;
    }
</style>
</head>
<body>

<h1>Face + Uniform Check</h1>

<video id="camera" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<div id="result">Starting…</div>

<script>
// ====== START CAMERA ======
let video = document.getElementById("camera");

navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => { video.srcObject = stream; })
.catch(err => { document.getElementById("result").innerHTML = "Camera Error"; });

// ====== CAPTURE FRAME ======
function capture() {
    return new Promise(resolve => {
        let canvas = document.getElementById("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);
        canvas.toBlob(resolve, "image/jpeg");
    });
}

// ====== SEND FACE ======
async function sendFace() {
    document.getElementById("result").innerHTML = "Checking face…";

    let blob = await capture();
    let fd = new FormData();
    fd.append("image", blob);

    let res = await fetch("/check_face", { method:"POST", body:fd });
    let data = await res.json();

    if (!data.match) {
        document.getElementById("result").innerHTML = "❌ Face Not Recognized";
        return;
    }

    document.getElementById("result").innerHTML = "✔ Face Match: " + data.id;
    sendUniform();
}

// ====== SEND UNIFORM ======
async function sendUniform() {
    document.getElementById("result").innerHTML += "<br>Checking uniform…";

    let blob = await capture();
    let fd = new FormData();
    fd.append("image", blob);

    let res = await fetch("/check_uniform", { method:"POST", body:fd });
    let data = await res.json();

    document.getElementById("result").innerHTML += "<br>✔ Uniform: " + data.uniform;
}

// Start after 2 seconds
setTimeout(sendFace, 2000);

</script>
</body>
</html>
